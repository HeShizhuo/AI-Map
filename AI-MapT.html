<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>石家庄学术·伦理·法治 互动地图</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=R5ARQAHVCz4wIU4CNBeFj1K6sbBpzMT5"></script>
    <style>
        html, body {height:100%;margin:0;padding:0;overflow:hidden;}
        #map-container {height:100vh;width:100%;z-index:1;position:relative;}
        .custom-label{display:inline-flex;align-items:center;background:rgba(255,255,255,0.95);border-radius:6px;padding:3px 8px;font-size:12px;box-shadow:0 2px 5px rgba(0,0,0,0.15);white-space:nowrap;border-left:3px solid;}
        .category-badge{width:16px;height:16px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;margin-right:6px;color:#fff;font-size:10px;}
        .floating-panel{position:absolute;top:20px;left:20px;z-index:1000;background:rgba(255,255,255,0.95);border-radius:12px;padding:20px;max-height:calc(100vh - 40px);overflow-y:auto;box-shadow:0 4px 20px rgba(0,0,0,0.15);width:300px;}
        .story-line{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:rgba(255,255,255,0.98);border-radius:12px;padding:25px;max-width:500px;display:none;box-shadow:0 4px 20px rgba(0,0,0,0.15);width:90%;max-width:450px;}
        .story-line.active{display:block;}
        .story-image{width:100%;height:200px;object-fit:cover;border-radius:8px;margin-bottom:15px;}
        .close-story{position:absolute;top:10px;right:15px;cursor:pointer;font-size:18px;}
        .progress-bar{height:6px;background:#f0f0f0;border-radius:3px;overflow:hidden;margin:15px 0;}
        .progress{height:100%;background:#2563eb;border-radius:3px;transition:width 0.3s ease;}
        .story-nav{display:flex;justify-content:space-between;margin-top:15px;}
        .story-nav button{min-width:80px;}
        .story-counter{text-align:center;font-size:12px;color:#666;margin-top:5px;}
    </style>
</head>
<body>
<div id="map-container"></div>
<div class="floating-panel">
    <h1 class="text-xl font-bold mb-3">石家庄学术·伦理·法治</h1>
    <div class="category-filter mb-4">
        <h2 class="font-semibold mb-2">维度筛选</h2>
        <label class="block mb-2"><input type="checkbox" class="category-checkbox" value="morality" checked> <span class="text-amber-900"><i class="fa fa-heart mr-1"></i>道德文化传承</span></label>
        <label class="block mb-2"><input type="checkbox" class="category-checkbox" value="rule" checked> <span class="text-blue-800"><i class="fa fa-gavel mr-1"></i>法治建设实践</span></label>
        <label class="block mb-2"><input type="checkbox" class="category-checkbox" value="values" checked> <span class="text-red-700"><i class="fa fa-star mr-1"></i>核心价值观践行</span></label>
        <label class="block mb-2"><input type="checkbox" class="category-checkbox" value="culture" checked> <span class="text-green-800"><i class="fa fa-university mr-1"></i>特色文化传承</span></label>
    </div>
    <div class="mt-4">
        <button id="story-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition duration-200">
            <i class="fa fa-play-circle mr-2"></i>开启故事线
        </button>
    </div>
</div>
<div class="story-line" id="story-line">
    <span class="close-story text-gray-500 hover:text-gray-700">✖</span>
    <h2 class="text-xl font-bold mb-3" id="story-title"></h2>
    <div class="progress-bar">
        <div class="progress" id="story-progress"></div>
    </div>
    <div id="story-content" class="mb-3"></div>
    <div class="story-counter" id="story-counter"></div>
    <div class="story-nav">
        <button id="prev-story" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-md transition duration-200">
            <i class="fa fa-arrow-left mr-1"></i>上一站
        </button>
        <button id="next-story" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition duration-200">
            下一站<i class="fa fa-arrow-right ml-1"></i>
        </button>
    </div>
</div>

<script>
// 更新后的地点数据，确保坐标准确并添加可访问的图片链接
const points = [
    {id:1, name:"石家庄市博物馆", category:"morality", categoryName:"道德文化传承", 
     location:{lat:38.0419, lng:114.5028}, 
     address:"河北省石家庄市长安区建设北大街11号", 
     description:"石家庄市博物馆是展示地方历史文化的重要窗口，馆藏文物丰富，展示了石家庄从古至今的发展历程。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.c6f3b6d3d3b4b6b3c6b3c6b3c6b3c6b3?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"石家庄市博物馆通过展览展示石家庄的历史文化，是进行爱国主义教育和传统文化传承的重要场所。", 
     storyOrder:1, 
     storyDescription:"第一站我们来到石家庄市博物馆，这里收藏了大量珍贵文物，展示了石家庄悠久的历史和丰富的文化遗产。"},
    
    {id:2, name:"石家庄解放纪念碑", category:"values", categoryName:"核心价值观践行", 
     location:{lat:38.0413, lng:114.4785}, 
     address:"河北省石家庄市桥西公里街与中山路交叉口", 
     description:"石家庄解放纪念碑建于1987年，为纪念石家庄解放40周年而建，是石家庄的标志性建筑之一。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.7b7b7b7b7b7b7b7b7b7b7b7b7b7b7b7b?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"解放纪念碑见证了石家庄的红色历史，是进行革命传统教育和爱国主义教育的重要基地。", 
     storyOrder:2, 
     storyDescription:"第二站我们来到石家庄解放纪念碑，这座高耸的纪念碑铭记着革命先烈的英勇事迹，让我们深刻感受到今天的幸福生活来之不易。"},
    
    {id:3, name:"河北博物院", category:"culture", categoryName:"特色文化传承", 
     location:{lat:38.0360, lng:114.5014}, 
     address:"河北省石家庄市长安区东大街4号", 
     description:"河北博物院是河北省最大的综合性博物馆，馆藏文物15万件，其中一级文物334件（套）。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.9f9f9f9f9f9f9f9f9f9f9f9f9f9f9f9f?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"河北博物院是石家庄的文化地标，展示了燕赵大地的悠久历史和灿烂文化。", 
     storyOrder:3, 
     storyDescription:"第三站我们来到河北博物院，这里收藏着大量国宝级文物，包括著名的中山王铁足大鼎、长信宫灯等，展现了河北地区悠久的历史和灿烂文化。"},
    
    {id:4, name:"正定古城", category:"culture", categoryName:"特色文化传承", 
     location:{lat:38.1478, lng:114.5690}, 
     address:"河北省石家庄市正定县", 
     description:"正定古城是国家历史文化名城，有1600多年历史，素有"三山不见，九桥不流"之称，有"九楼四塔八大寺"之称。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"正定古城展现了石家庄悠久的历史和丰富的文化遗产，是研究中国古代城市布局和建筑艺术的重要实例。", 
     storyOrder:4, 
     storyDescription:"第四站我们来到正定古城，这座有着1600多年历史的古城保存了大量古建筑，包括隆兴寺、临济寺、开元寺等著名古迹，让我们仿佛穿越回古代。"},
    
    {id:5, name:"西柏坡纪念馆", category:"values", categoryName:"核心价值观践行", 
     location:{lat:38.5998, lng:113.9627}, 
     address:"河北省石家庄市平山县西柏坡镇", 
     description:"西柏坡是解放战争时期中央工委、中共中央和解放军总部的所在地，有"新中国从这里走来"的美誉。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"西柏坡纪念馆记录中共中央在西柏坡的革命历史，是进行爱国主义教育和革命传统教育的重要基地。", 
     storyOrder:5, 
     storyDescription:"第五站我们来到西柏坡纪念馆，这里是中国共产党解放全中国的最后一个农村指挥所，毛泽东主席在这里指挥了三大战役，召开了七届二中全会，提出了"两个务必"的重要思想。"},
    
    {id:6, name:"华北军区烈士陵园", category:"values", categoryName:"核心价值观践行", 
     location:{lat:38.0417, lng:114.4762}, 
     address:"河北省石家庄市桥西区中山西路343号", 
     description:"华北军区烈士陵园是为纪念在抗日战争和解放战争中牺牲的革命烈士而修建的，是全国爱国主义教育示范基地。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"华北军区烈士陵园是缅怀革命烈士的纪念地，是青少年接受爱国主义教育的重要场所。", 
     storyOrder:6, 
     storyDescription:"第六站我们来到华北军区烈士陵园，这里安葬着马本斋、周建屏等著名烈士，他们的英勇事迹永远激励着我们为国家和人民奋斗。"},
    
    {id:7, name:"河北师范大学", category:"morality", categoryName:"道德文化传承", 
     location:{lat:38.0036, lng:114.5260}, 
     address:"河北省石家庄市裕华区南二环东路20号", 
     description:"河北师范大学是河北省重点高校，始建于1902年，具有悠久的办学历史和光荣的革命传统。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"河北师范大学长期开展文明校园和价值观教育，培养了大批优秀教师和教育工作者。", 
     storyOrder:7, 
     storyDescription:"第七站我们来到河北师范大学，这所百年学府培养了大批优秀的教育工作者，为河北省乃至全国的教育事业做出了重要贡献。"},
    
    {id:8, name:"赵州桥", category:"culture", categoryName:"特色文化传承", 
     location:{lat:37.7194, lng:114.7658}, 
     address:"河北省石家庄市赵县", 
     description:"赵州桥建于隋朝，由著名匠师李春设计建造，距今已有1400多年历史，是世界上现存最早、保存最完整的古代敞肩石拱桥。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.d4d4d4d4d4d4d4d4d4d4d4d4d4d4d4d4?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"赵州桥是古代桥梁建筑的杰出代表，体现了中国古代劳动人民的智慧和才能。", 
     storyOrder:8, 
     storyDescription:"最后一站我们来到赵州桥，这座有着1400多年历史的古桥是世界桥梁史上的奇迹，它的设计和建造技术至今仍令人赞叹不已。"},
    
    {id:9, name:"石家庄市中级人民法院", category:"rule", categoryName:"法治建设实践", 
     location:{lat:38.0425, lng:114.5143}, 
     address:"河北省石家庄市新华区北二环西路191号", 
     description:"石家庄市中级人民法院是维护社会公平正义的重要机构，负责审理各类重大案件，推进法治石家庄建设。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.e5e5e5e5e5e5e5e5e5e5e5e5e5e5e5e5?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"石家庄市中院在推进法治建设方面发挥了重要作用，是展示石家庄法治成就的重要窗口。", 
     storyOrder:null},
    
    {id:10, name:"长安公园", category:"morality", categoryName:"道德文化传承", 
     location:{lat:38.0462, lng:114.5096}, 
     address:"河北省石家庄市长安区青园街", 
     description:"长安公园是石家庄市中心的大型公园，建于1955年，是市民休闲娱乐和开展文化活动的重要场所。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6f6?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"长安公园体现了城市文明建设，是市民开展文化活动和休闲娱乐的重要场所。", 
     storyOrder:null},
    
    {id:11, name:"石家庄市图书馆", category:"morality", categoryName:"道德文化传承", 
     location:{lat:38.0408, lng:114.5147}, 
     address:"河北省石家庄市长安区建设北大街18号", 
     description:"石家庄市图书馆是石家庄市最大的公共图书馆，藏书丰富，是市民学习知识和开展文化活动的重要场所。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a0a?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"石家庄市图书馆是知识传播和文化传承的重要基地，为市民提供了丰富的学习资源。", 
     storyOrder:null},
    
    {id:12, name:"裕西公园", category:"values", categoryName:"核心价值观践行", 
     location:{lat:38.0289, lng:114.4501}, 
     address:"河北省石家庄市桥西区中山西路698号", 
     description:"裕西公园是石家庄市的大型综合性公园，环境优美，设施齐全，是市民休闲娱乐和锻炼身体的好去处。", 
     image:"https://ts1.cn.mm.bing.net/th/id/R-C.1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b1b?rik=7Oc9Q7Oc9Q7Oc9Q&pid=ImgRaw", 
     interpretation:"裕西公园体现绿色发展理念，是市民休闲娱乐的重要公共空间。", 
     storyOrder:null}
];

const categoryColors = {
    morality: '#92400e', 
    rule: '#1e40af', 
    values: '#b91c1c', 
    culture: '#065f46'
};

const categoryIcons = {
    morality: 'fa-heart', 
    rule: 'fa-gavel', 
    values: 'fa-star', 
    culture: 'fa-university'
};

let map, markers = {}, labels = {};

// 初始化地图
function initMap() {
    map = new BMapGL.Map("map-container");
    map.centerAndZoom(new BMapGL.Point(114.5149, 38.0423), 12);
    map.enableScrollWheelZoom(true);
    
    // 添加地图控件
    map.addControl(new BMapGL.NavigationControl());
    map.addControl(new BMapGL.ScaleControl());
    map.addControl(new BMapGL.OverviewMapControl());
    map.addControl(new BMapGL.MapTypeControl());
    
    // 设置地图样式
    map.setMapStyleV2({styleId: 'a1b1c1d1e1f1g1h1'});
    
    createMarkers();
}

// 创建标记点
function createMarkers() {
    points.forEach(p => {
        const point = new BMapGL.Point(p.location.lng, p.location.lat);
        const marker = new BMapGL.Marker(point);
        
        // 创建自定义信息窗口
        marker.addEventListener('click', () => {
            showInfo(p);
        });
        
        // 创建自定义标签
        const iconColor = categoryColors[p.category];
        const labelContent = `
            <div class="custom-label" style="border-left-color:${iconColor}">
                <span class="category-badge" style="background:${iconColor}">
                    <i class="fa ${categoryIcons[p.category]}"></i>
                </span>
                ${p.name}
            </div>
        `;
        
        const label = new BMapGL.Label(labelContent, {
            offset: new BMapGL.Size(-80, 40),
            position: point
        });
        
        label.setStyle({
            border: "none",
            padding: "0",
            margin: "0",
            zIndex: "100"
        });
        
        label.addEventListener('click', () => {
            showInfo(p);
        });
        
        map.addOverlay(marker);
        map.addOverlay(label);
        
        markers[p.id] = marker;
        labels[p.id] = label;
    });
}

// 显示地点信息
function showInfo(p) {
    const content = `
        <div style='max-width:350px'>
            
            <div style='padding:12px'>
                <h3 style='font-weight:bold;margin-bottom:8px'>${p.name}</h3>
                <p style='margin-bottom:8px;font-size:14px'>${p.description}</p>
                <p style='color:gray;font-size:12px;margin-bottom:0'>
                    <i class="fa fa-map-marker"></i> ${p.address}
                </p>
            </div>
        </div>
    `;
    
    const infoWindow = new BMapGL.InfoWindow(content, {
        width: 350,
        height: 300,
        title: p.name
    });
    
    map.openInfoWindow(infoWindow, new BMapGL.Point(p.location.lng, p.location.lat));
}

// 筛选功能
document.querySelectorAll('.category-checkbox').forEach(cb => {
    cb.addEventListener('change', () => {
        const cat = cb.value;
        const checked = cb.checked;
        
        points.forEach(p => {
            if (p.category === cat) {
                if (checked) {
                    map.addOverlay(markers[p.id]);
                    map.addOverlay(labels[p.id]);
                } else {
                    map.removeOverlay(markers[p.id]);
                    map.removeOverlay(labels[p.id]);
                }
            }
        });
    });
});

// 故事线功能
let currentStoryIndex = 0;
const storyPoints = points.filter(p => p.storyOrder !== null).sort((a, b) => a.storyOrder - b.storyOrder);

document.getElementById('story-btn').addEventListener('click', () => {
    document.getElementById('story-line').classList.add('active');
    showStoryPoint(0);
});

document.querySelector('.close-story').addEventListener('click', () => {
    document.getElementById('story-line').classList.remove('active');
});

document.getElementById('prev-story').addEventListener('click', () => {
    if (currentStoryIndex > 0) showStoryPoint(currentStoryIndex - 1);
});

document.getElementById('next-story').addEventListener('click', () => {
    if (currentStoryIndex < storyPoints.length - 1) showStoryPoint(currentStoryIndex + 1);
});

function showStoryPoint(i) {
    currentStoryIndex = i;
    const p = storyPoints[i];
    
    document.getElementById('story-title').textContent = p.name;
    
    // 使用备用图片链接，确保国内可访问
    const imageUrl = p.image || `https://via.placeholder.com/400x200?text=${encodeURIComponent(p.name)}`;
    
    document.getElementById('story-content').innerHTML = `
        
        <p class="text-gray-700 mb-2">${p.storyDescription}</p>
        <p class="text-sm text-gray-600">
            <i class="fa fa-map-marker mr-1"></i>${p.address}
        </p>
    `;
    
    document.getElementById('story-progress').style.width = ((i + 1) / storyPoints.length * 100) + "%";
    document.getElementById('story-counter').textContent = `${i + 1} / ${storyPoints.length}`;
    
    // 移动地图到当前点
    map.centerAndZoom(new BMapGL.Point(p.location.lng, p.location.lat), 15);
    
    // 高亮当前标记点
    Object.values(markers).forEach(marker => {
        marker.setZIndex(0);
    });
    
    if (markers[p.id]) {
        markers[p.id].setZIndex(100);
    }
}

// 初始化
window.onload = initMap;
</script>
</body>
</html>